razor
@page "/technologies"
@using myapp.Services
@inject ResourceService ResourceService
@inject TechnologyService TechnologyService
@implements IDisposable

<style>
    .buildings-banner {
        background-image: url('buildings-banner.jpg'); /* Replace with your image path */
        background-size: cover;
        background-position: center;
        color: white;
        text-align: center;
        padding: 100px 20px;
        margin-bottom: 20px;
    }

    .buildings-banner h2 {
        font-size: 3em;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
    }

    .buildings-grid {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 20px;
    }

    .technology-card {
        background-color: #333;
        border-radius: 5px;
        padding: 20px;
        text-align: center;
        border: 1px solid #555;
        color: white;
        display: flex;
        flex-direction: column;
        justify-content: space-between;
        position: relative;
        align-items: center;
        gap: 10px;
    }

    .technology-card img {
        width: 177px;
        height: 177px;
        display: flex;
        justify-content: center;
        align-items: center;
        margin: 0 auto;
        object-fit: cover;
        border: 2px solid #777;
        border-radius: 5px;
    }

    .technology-card .level {
        position: absolute;
        top: 10px;
        right: 10px;
        background-color: #555;
        padding: 5px 10px;
        border-radius: 5px;
        font-weight: bold;
    }
    
    .technology-card h3 {
        margin: 10px 0;
    }

    .technology-card button {
        padding: 10px;
        background-color: #555;
        color: white;
        border: none;
        cursor: pointer;
        border-radius: 5px;
        width: 100%;
        margin-top: auto;
    }
    
    .cost-item {
        font-size: 0.9em;
        margin: 2px 0;
    }
    
    .research-progress {
        width: 100%;
        background-color: #444;
        border-radius: 5px;
        padding: 10px;
        margin-bottom: 20px;
        text-align: center;
    }
</style>

<div class="buildings-banner">
    <h2>Technologies</h2>
</div>

@if(TechnologyService.CurrentResearch != null)
{
    <div class="research-progress">
        <h3>Researching: @TechnologyService.CurrentResearch.Title</h3>
        <p>Level: @(TechnologyService.CurrentResearch.Level + 1)</p>
        <p>Time Remaining: @TechnologyService.CurrentResearch.TimeRemaining.ToString(@"hh\:mm\:ss")</p>
        <button @onclick="CancelResearch">Cancel</button>
    </div>
}

<div class="buildings-grid">
    @foreach (var tech in TechnologyService.Technologies)
    {
        <div class="technology-card">
            <span class="level">Level: @tech.Level</span>
            <img src="@tech.Image" alt="@tech.Title" />
            <h3>@tech.Title</h3>
            <p>@tech.Description</p>
            
            <div class="costs">
                @if(tech.MetalCost > 0) { <div class="cost-item">Metal: @tech.MetalCost.ToString("N0")</div> }
                @if(tech.CrystalCost > 0) { <div class="cost-item">Crystal: @tech.CrystalCost.ToString("N0")</div> }
                @if(tech.DeuteriumCost > 0) { <div class="cost-item">Deuterium: @tech.DeuteriumCost.ToString("N0")</div> }
                @if(tech.EnergyCost > 0) { <div class="cost-item">Energy: @tech.EnergyCost.ToString("N0")</div> }
            </div>

            <p>Duration: @tech.Duration.ToString()</p>
            
            @if (TechnologyService.CurrentResearch == null)
            {
                <button @onclick="() => StartResearch(tech)">Research</button>
            }
            else if (TechnologyService.CurrentResearch == tech)
            {
                <button disabled>Researching...</button>
            }
            else
            {
                 <button disabled>Queue Busy</button>
            }
        </div>
    }
</div>

@code {
    protected override void OnInitialized()
    {
        ResourceService.OnChange += RefreshState;
        TechnologyService.OnChange += RefreshState;
    }

    private async void RefreshState()
    {
        await InvokeAsync(StateHasChanged);
    }

    private void StartResearch(Technology tech)
    {
        TechnologyService.StartResearch(tech);
    }

    private void CancelResearch()
    {
        TechnologyService.CancelResearch();
    }

    public void Dispose()
    {
        ResourceService.OnChange -= RefreshState;
        TechnologyService.OnChange -= RefreshState;
    }
}